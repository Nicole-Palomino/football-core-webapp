<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración de Fútbol</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Bootstrap Icons (opcional, pero útil para algunos íconos) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Barra lateral de navegación -->
            <aside class="col-md-4 col-lg-2 d-md-block sidebar collapse">
                <h1 class="h3 mb-4 text-center text-success">Admin Panel</h1>
                <nav class="nav flex-column">
                    <button id="nav-dashboard" class="nav-link btn btn-link text-start text-white-50">
                        <i class="bi bi-house-door me-2"></i> Dashboard
                    </button>
                    <button id="nav-users" class="nav-link btn btn-link text-start active">
                        <i class="bi bi-person-bounding-box me-2"></i> Usuarios
                    </button>
                    <button id="nav-matches" class="nav-link btn btn-link text-start active">
                        <i class="bi bi-calendar-event me-2"></i> Partidos
                    </button>
                    <button id="nav-teams" class="nav-link btn btn-link text-start">
                        <i class="bi bi-people me-2"></i> Equipos
                    </button>
                    <button id="nav-ligas" class="nav-link btn btn-link text-start">
                        <i class="bi bi-flag me-2"></i> Ligas
                    </button>
                    <button id="nav-seasons" class="nav-link btn btn-link text-start">
                        <i class="bi bi-flag me-2"></i> Temporadas
                    </button>
                    <button id="nav-estados" class="nav-link btn btn-link text-start">
                        <i class="bi bi-check-circle me-2"></i> Estados
                    </button>
                    <button id="nav-roles" class="nav-link btn btn-link text-start">
                        <i class="bi bi-person-badge me-2"></i> Roles
                    </button>
                </nav>
                <div class="mt-auto pt-4 text-center border-top border-secondary">
                    <small class="text-secondary d-block">Usuario: <span id="user-email" class="fw-bold">Cargando...</span></small>
                    <button id="logout-button" class="btn btn-danger btn-sm mt-2">Cerrar Sesión</button>
                    <small class="text-secondary d-block mt-5">&copy; 2025 Panel de Admin.</small>
                </div>
            </aside>

            <!-- Contenido principal -->
            <main class="col-md-8 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div id="dashboard-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Dashboard</h2>
                    <!-- Loading Overlay for Dashboard -->
                    <div id="dashboard-loading-overlay" class="dashboard-loading-overlay">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <span class="spinner-message">Cargando datos del dashboard...</span>
                    </div>
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="card dashboard-card card-primary">
                                <div class="card-body">
                                    <div>
                                        <h5 class="card-title" id="total-matches">0</h5>
                                        <p class="card-text">Partidos Totales</p>
                                    </div>
                                    <i class="bi bi-calendar-event card-icon"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card card-success">
                                <div class="card-body">
                                    <div>
                                        <h5 class="card-title" id="total-teams">0</h5>
                                        <p class="card-text">Equipos Totales</p>
                                    </div>
                                    <i class="bi bi-people card-icon"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card card-success">
                                <div class="card-body">
                                    <div>
                                        <h5 class="card-title" id="total-users">0</h5>
                                        <p class="card-text">Usuarios Totales</p>
                                    </div>
                                    <i class="bi bi-person-circle card-icon"></i>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card dashboard-card card-success">
                                <div class="card-body">
                                    <div>
                                        <h5 class="card-title" id="total-leagues">0</h5>
                                        <p class="card-text">Ligas Totales</p>
                                    </div>
                                    <i class="bi bi-flag card-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cuadro para la tabla de usuarios registrados por día -->
                    <div class="row g-4 mt-4">
                        <div class="col-12">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <h3 class="card-title h4 fw-bold mb-3">Usuarios Registrados por Día</h3>
                                    <div class="mb-3">
                                        <label for="monthSelect" class="form-label">Seleccionar Mes:</label>
                                        <select id="monthSelect" class="form-select w-auto d-inline-block"></select>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Día</th>
                                                    <th class="text-center">Usuarios Registrados</th>
                                                </tr>
                                            </thead>
                                            <tbody id="daily-registrations-table-body">
                                                <tr>
                                                    <td colspan="2" class="text-center py-4">
                                                        <div class="d-flex align-items-center justify-content-center">
                                                            <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                                <span class="visually-hidden">Cargando...</span>
                                                            </div> Cargando datos de usuarios...
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Usuarios -->
                <div id="users-section" class="content-section">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Usuarios</h2>

                    <!-- Formulario para añadir/editar usuario -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="user-form-title">Añadir Nuevo Usuario</h3>
                            <form id="user-form" class="row g-3">
                                <input type="hidden" id="user-id">

                                <div class="col-md-4">
                                    <label for="user-name" class="form-label">Nombre de usuario:</label>
                                    <input type="text" id="user-name" name="userName" class="form-control" placeholder="Ej. adminuser" required>
                                </div>

                                <div class="col-md-4">
                                    <label for="email-user" class="form-label">Correo electrónico:</label>
                                    <input type="email" id="email-user" name="emailUser" class="form-control" placeholder="Ej. usuario@example.com" required>
                                </div>

                                <div class="col-md-4">
                                    <label for="contrasena" class="form-label">Contraseña:</label>
                                    <input type="password" id="contrasena" name="contrasenaUser" class="form-control" placeholder="********" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="user-estado" class="form-label">Estado del Sistema:</label>
                                    <select id="user-estado" name="id_estado" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="user-rol" class="form-label">Rol del Usuario:</label>
                                    <select id="user-rol" name="id_rol" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Usuario</button>
                                    <button type="button" id="cancel-user-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de usuarios -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Usuarios</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Usuario</th>
                                            <th>Correo</th>
                                            <th>Estado</th>
                                            <th>Rol</th>
                                            <th>Registro</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body">
                                        <tr>
                                            <td colspan="9" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando usuarios...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Partidos -->
                <div id="matches-section" class="content-section">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Partidos</h2>

                    <!-- Botón para subir archivos -->
                    <div class="mb-4">
                        <button id="upload-data-btn" class="btn btn-success">
                            <i class="bi bi-upload me-2"></i> Subir Datos (CSV/Excel)
                        </button>
                    </div>

                    <!-- Formulario para añadir/editar partido -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="match-form-title">Añadir Nuevo Partido</h3>
                            <form id="match-form" class="row g-3">
                                <input type="hidden" id="match-id">

                                <div class="col-md-4">
                                    <label for="match-liga" class="form-label">Liga del partido:</label>
                                    <select id="match-liga" name="id_liga" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label for="match-temporada" class="form-label">Temporada del partido:</label>
                                    <select id="match-temporada" name="id_temporada" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <label for="match-date" class="form-label">Fecha:</label>
                                    <input type="date" id="match-date" name="dia" class="form-control" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="home-team" class="form-label">Equipo Local:</label>
                                    <select id="home-team" name="id_equipo_local" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="away-team" class="form-label">Equipo Visitante:</label>
                                    <select id="away-team" name="id_equipo_visita" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-6">
                                    <label for="threesixfive" class="form-label">Enlace 365Scores:</label>
                                    <input type="text" id="threesixfive" name="enlace_threesixfive" class="form-control" placeholder="Ej. https://">
                                </div>

                                <div class="col-6">
                                    <label for="fotmob" class="form-label">Enlace Fotmob:</label>
                                    <input type="text" id="fotmob" name="enlace_fotmob" class="form-control" placeholder="Ej. https://">
                                </div>

                                <div class="col-6">
                                    <label for="datafactory" class="form-label">Enlace DataFactory:</label>
                                    <input type="text" id="datafactory" name="enlace_datafactory" class="form-control" placeholder="Ej. https://">
                                </div>

                                <div class="col-md-6">
                                    <label for="estado" class="form-label">Estado del Partido:</label>
                                    <select id="estado" name="id_estado" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Partido</button>
                                    <button type="button" id="cancel-match-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de partidos -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Partidos</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Equipo Local</th>
                                            <th>Equipo Visitante</th>
                                            <th>Fecha</th>
                                            <th>Liga</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="matches-table-body">
                                        <tr>
                                            <td colspan="7" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando partidos...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Equipos -->
                <div id="teams-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Equipos</h2>

                    <!-- Formulario para añadir/editar equipo -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="team-form-title">Añadir Nuevo Equipo</h3>
                            <form id="team-form" class="row g-3">
                                <input type="hidden" id="team-id">

                                <div class="col-md-6">
                                    <label for="team-name" class="form-label">Nombre del Equipo:</label>
                                    <input type="text" id="team-name" name="name" class="form-control" placeholder="Ej. Liverpool" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="team-stadium" class="form-label">Estadio:</label>
                                    <input type="text" id="team-stadium" name="stadium" class="form-control" placeholder="Ej. Anfield" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="team-logo" class="form-label">URL del escudo:</label>
                                    <input type="text" id="team-logo" name="logo" class="form-control" placeholder="Ej. https://" required>
                                </div>

                                <div class="col-md-3">
                                    <label for="team-estado" class="form-label">Estado del equipo:</label>
                                    <select id="team-estado" name="id_estado" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-md-3">
                                    <label for="team-liga" class="form-label">Liga del equipo:</label>
                                    <select id="team-liga" name="id_liga" class="form-select" required>
                                        <!-- Opciones cargadas dinámicamente -->
                                    </select>
                                </div>

                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Equipo</button>
                                    <button type="button" id="cancel-team-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de equipos -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Equipos</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Estado</th>
                                            <th>Liga</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teams-table-body">
                                        <tr>
                                            <td colspan="4" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando equipos...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Ligas -->
                <div id="ligas-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Ligas</h2>

                    <!-- Formulario para añadir/editar liga -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="liga-form-title">Añadir Nueva Liga</h3>
                            <form id="liga-form" class="row g-3">
                                <input type="hidden" id="liga-id">

                                <div class="col-md-6">
                                    <label for="liga-name" class="form-label">Nombre de la Liga:</label>
                                    <input type="text" id="liga-name" name="name" class="form-control" placeholder="Ej. Premier League" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="liga-country" class="form-label">País:</label>
                                    <input type="text" id="liga-country" name="country" class="form-control" placeholder="Ej. Inglaterra" required>
                                </div>

                                <div class="col-md-6">
                                    <label for="liga-logo" class="form-label">URL del Logo de la Liga:</label>
                                    <input type="text" id="liga-logo" name="logo" class="form-control" placeholder="Ej. https://">
                                </div>

                                <div class="col-md-6">
                                    <label for="liga-logo-country" class="form-label">URL del Logo del País:</label>
                                    <input type="text" id="liga-logo-country" name="logoCountry" class="form-control" placeholder="Ej. https://">
                                </div>

                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Liga</button>
                                    <button type="button" id="cancel-liga-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de ligas -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Ligas</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>País</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ligas-table-body">
                                        <tr>
                                            <td colspan="4" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando ligas...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Temporadas -->
                <div id="seasons-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Temporadas</h2>

                    <!-- Formulario para añadir/editar temporada -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="season-form-title">Añadir Nueva Temporada</h3>
                            <form id="season-form" class="row g-3">
                                <input type="hidden" id="season-id">

                                <div class="col-md-6">
                                    <label for="season-name" class="form-label">Nombre de la Temporada:</label>
                                    <input type="text" id="season-name" name="name" class="form-control" placeholder="Ej. 2024-2025" required>
                                </div>

                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Temporada</button>
                                    <button type="button" id="cancel-season-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de temporadas -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Temporadas</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="seasons-table-body">
                                        <tr>
                                            <td colspan="4" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando temporadas...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Estados -->
                <div id="estados-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Estados</h2>
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="estado-form-title">Añadir Nuevo Estado</h3>
                            <form id="estado-form" class="row g-3">
                                <input type="hidden" id="estado-id">
                                <div class="col-md-6">
                                    <label for="estado-name" class="form-label">Nombre del Estado:</label>
                                    <input type="text" id="estado-name" name="name" class="form-control" placeholder="Ej. Activo" required>
                                </div>
                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Estado</button>
                                    <button type="button" id="cancel-estado-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Estados</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Creado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="estados-table-body">
                                        <tr>
                                            <td colspan="3" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando estados...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sección de Roles -->
                <div id="roles-section" class="content-section d-none">
                    <h2 class="display-4 fw-bold text-dark mb-4">Gestión de Roles</h2>
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-4" id="rol-form-title">Añadir Nuevo Rol</h3>
                            <form id="rol-form" class="row g-3">
                                <input type="hidden" id="rol-id">
                                <div class="col-md-6">
                                    <label for="rol-name" class="form-label">Nombre del Rol:</label>
                                    <input type="text" id="rol-name" name="name" class="form-control" placeholder="Ej. Administrador" required>
                                </div>
                                <div class="col-12 text-end">
                                    <button type="submit" class="btn btn-primary me-2">Guardar Rol</button>
                                    <button type="button" id="cancel-rol-edit" class="btn btn-secondary d-none">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h4 fw-bold mb-3">Lista de Roles</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nombre</th>
                                            <th>Creado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="roles-table-body">
                                        <tr>
                                            <td colspan="3" class="text-center py-4">
                                                <div class="d-flex align-items-center justify-content-center">
                                                    <div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                        <span class="visually-hidden">Cargando...</span>
                                                    </div> Cargando roles...
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para Editar Estadísticas -->
    <div class="modal fade" id="statisticsModal" tabindex="-1" aria-labelledby="statisticsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statisticsModalLabel">Estadísticas del Partido ID: <span id="modal-match-id"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="statistics-form" class="row g-3">
                        <input type="hidden" id="stat-id-estadistica">
                        <input type="hidden" id="stat-id-partido">

                        <div class="col-md-4">
                            <label for="stat-FTHG" class="form-label">Goles Local (FTHG):</label>
                            <input type="number" id="stat-FTHG" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="stat-FTAG" class="form-label">Goles Visita (FTAG):</label>
                            <input type="number" id="stat-FTAG" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="stat-FTR" class="form-label">Resultado (FTR):</label>
                            <select id="stat-FTR" class="form-select">
                                <option value="">Seleccione</option>
                                <option value="H">Local</option>
                                <option value="D">Empate</option>
                                <option value="A">Visita</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="stat-HTHG" class="form-label">Goles Local (HTHG):</label>
                            <input type="number" id="stat-HTHG" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="stat-HTAG" class="form-label">Goles Visita (HTAG):</label>
                            <input type="number" id="stat-HTAG" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="stat-HTR" class="form-label">Resultado (HTR):</label>
                            <select id="stat-HTR" class="form-select">
                                <option value="">Seleccione</option>
                                <option value="H">Local</option>
                                <option value="D">Empate</option>
                                <option value="A">Visita</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HS" class="form-label">Tiros Local:</label>
                            <input type="number" id="stat-HS" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AS" class="form-label">Tiros Visita:</label>
                            <input type="number" id="stat-AS" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HST" class="form-label">Tiros a Puerta Local:</label>
                            <input type="number" id="stat-HST" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AST" class="form-label">Tiros a Puerta Visita:</label>
                            <input type="number" id="stat-AST" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HF" class="form-label">Faltas Local:</label>
                            <input type="number" id="stat-HF" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AF" class="form-label">Faltas Visita:</label>
                            <input type="number" id="stat-AF" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HC" class="form-label">Corners Local:</label>
                            <input type="number" id="stat-HC" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AC" class="form-label">Corners Visita:</label>
                            <input type="number" id="stat-AC" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HY" class="form-label">Amarillas Local:</label>
                            <input type="number" id="stat-HY" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AY" class="form-label">Amarillas Visita:</label>
                            <input type="number" id="stat-AY" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-HR" class="form-label">Rojas Local:</label>
                            <input type="number" id="stat-HR" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label for="stat-AR" class="form-label">Rojas Visita:</label>
                            <input type="number" id="stat-AR" class="form-control">
                        </div>
                        
                        <div class="col-12 text-end mt-4">
                            <button type="submit" class="btn btn-primary me-2">Guardar Estadísticas</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <script src="js/estados.js"></script>
    <script src="js/roles.js"></script>
    <script src="js/usuarios.js"></script>
    <script src="js/ligas.js"></script>
    <script src="js/equipos.js"></script>
    <script src="js/temporadas.js"></script>
    <script src="js/estadisticas.js"></script>
    <script src="js/partidos.js"></script>
    <script>
        // --- Lógica de la Interfaz de Usuario (Renderer Process) ---
        // Elementos del DOM
        const navButtons = {
            dashboard: document.getElementById('nav-dashboard'),
            users: document.getElementById('nav-users'),
            matches: document.getElementById('nav-matches'),
            teams: document.getElementById('nav-teams'),
            ligas: document.getElementById('nav-ligas'),
            seasons: document.getElementById('nav-seasons'),
            estados: document.getElementById('nav-estados'),
            roles: document.getElementById('nav-roles')
        };
        const contentSections = {
            dashboard: document.getElementById('dashboard-section'),
            users: document.getElementById('users-section'),
            matches: document.getElementById('matches-section'),
            teams: document.getElementById('teams-section'),
            ligas: document.getElementById('ligas-section'),
            seasons: document.getElementById('seasons-section'),
            estados: document.getElementById('estados-section'),
            roles: document.getElementById('roles-section')
        };

        // Elementos del Dashboard
        const totalMatchesElem = document.getElementById('total-matches');
        const totalTeamsElem = document.getElementById('total-teams');
        const totalUsersElem = document.getElementById('total-users');
        const totalLeaguesElem = document.getElementById('total-leagues');
        const userEmailElem = document.getElementById('user-email');
        const logoutButton = document.getElementById('logout-button');
        const dashboardLoadingOverlay = document.getElementById('dashboard-loading-overlay');
        const dailyRegistrationsTableBody = document.getElementById('daily-registrations-table-body');
        const monthSelect = document.getElementById('monthSelect');
        let allUsersData = []; // Para almacenar todos los usuarios y evitar recargas constantes
        let currentView = 'dashboard'; // Vista inicial

        // --- Funciones de Utilidad de la UI ---

        /**
         * Muestra un mensaje de alerta usando SweetAlert2.
         * @param {string} icon 'success', 'error', 'warning', 'info', 'question'
         * @param {string} title El título de la alerta.
         * @param {string} text El texto del cuerpo de la alerta.
         */
        function showAlert(icon, title, text) {
            Swal.fire({
                icon: icon,
                title: title,
                text: text,
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }

        /**
         * Alterna la visibilidad de las secciones de contenido.
         * @param {string} sectionName El nombre de la sección a mostrar.
         */
        function showSection(sectionName) {
            Object.values(contentSections).forEach(section => section.classList.add('d-none'));
            contentSections[sectionName].classList.remove('d-none');

            Object.values(navButtons).forEach(button => button.classList.remove('active'));
            navButtons[sectionName].classList.add('active');

            currentView = sectionName; // Actualiza la vista actual
            if (sectionName === 'users') {
                loadUsers();
                loadLookupDataForUsers();
                resetUserForm();
            } else if (sectionName === 'matches') {
                loadMatches();
                loadLookupDataForMatches();
                resetMatchForm(); 
            } else if (sectionName === 'teams') {
                loadTeams();
                loadLookupDataForTeams();
                resetTeamForm(); 
            } else if (sectionName === 'ligas') {
                loadLigas()
                resetLigasForm()
            } else if (sectionName === 'seasons') {
                loadSeasons()
                resetSeasonForm()
            } else if (sectionName === 'estados') {
                loadEstados();
                resetEstadoForm();
            } else if (sectionName === 'roles') {
                loadRoles();
                resetRolForm();
            } else if (sectionName === 'dashboard') {
                updateDashboard();
            }
        }

        // --- Funciones del Dashboard ---

        /**
         * Actualiza los datos del dashboard.
         */
        async function updateDashboard() {
            dashboardLoadingOverlay.classList.remove('d-none');
            try {
                const matches = await window.api.getMatchesTotal()
                const teams = await window.api.getTeamsTotal()
                const users = await window.api.getUsersTotal()
                const leagues = await window.api.getLigasTotal()

                // Elementos para la tabla de registros diarios
                allUsersData = await window.api.getUsersTotalByDia(); 

                totalMatchesElem.textContent = matches;
                totalTeamsElem.textContent = teams;
                totalUsersElem.textContent = users;
                totalLeaguesElem.textContent = leagues;

                populateMonthSelect(allUsersData);
                // Si hay meses en el selector, muestra los datos del mes actual o el primero
                if (monthSelect.options.length > 0) {
                    const currentMonth = new Date().toLocaleString('es-ES', { year: 'numeric', month: '2-digit' });
                    // Intenta seleccionar el mes actual, si no, selecciona el primero
                    monthSelect.value = Array.from(monthSelect.options).find(opt => opt.value === currentMonth) ? currentMonth : monthSelect.options[0].value;
                    renderDailyRegistrationsTable(monthSelect.value);
                } else {
                    dailyRegistrationsTableBody.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-muted">No hay datos de registro de usuarios.</td></tr>`;
                }
            } catch (error) {
                console.error('Error al actualizar el dashboard:', error);
                dailyRegistrationsTableBody.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-danger">Error al cargar datos del dashboard.</td></tr>`;
            } finally {
                dashboardLoadingOverlay.classList.add('d-none'); // Hide spinner
            }
        }

        /**
         * Popula el selector de meses con los meses únicos de los registros de usuarios.
         * @param {Array<Object>} usersData Datos de todos los usuarios.
         */
        function populateMonthSelect(usersData) {
            const months = new Set();
            usersData.forEach(user => {
                if (user.fecha) {
                    const date = new Date(user.fecha);
                    // Formato YYYY-MM para el valor, y "Mes Año" para el texto
                    const monthYearValue = date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0');
                    const monthYearText = date.toLocaleString('es-ES', { month: 'long', year: 'numeric' });
                    months.add(JSON.stringify({ value: monthYearValue, text: monthYearText }));
                }
            });

            const sortedMonths = Array.from(months).map(s => JSON.parse(s)).sort((a, b) => {
                return new Date(a.value) - new Date(b.value);
            });

            monthSelect.innerHTML = '';
            sortedMonths.forEach(month => {
                const option = document.createElement('option');
                option.value = month.value;
                option.textContent = month.text;
                monthSelect.appendChild(option);
            });

            monthSelect.onchange = () => renderDailyRegistrationsTable(monthSelect.value);
        }

        /**
         * Renderiza la tabla de usuarios registrados por día para el mes seleccionado.
         * @param {string} selectedMonthYear Valor del mes seleccionado (YYYY-MM).
         */
        function renderDailyRegistrationsTable(selectedMonthYear) {
            dailyRegistrationsTableBody.innerHTML = `<tr><td colspan="2" class="text-center py-4"><div class="d-flex align-items-center justify-content-center"><div class="spinner-border text-primary spinner-border-sm me-2" role="status">
                                                    <span class="visually-hidden">Cargando...</span>
                                                </div> Cargando registros diarios...</div></td></tr>`;
            
            const dailyRegistrations = {};
            allUsersData.forEach(user => {
                if (user.fecha) {
                    const date = new Date(user.fecha);
                    const monthYearOfUser = date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0');

                    if (monthYearOfUser === selectedMonthYear) {
                        const dayOfMonth = date.getDate();
                        dailyRegistrations[dayOfMonth] = (dailyRegistrations[dayOfMonth] || 0) + 1;
                    }
                }
            });

            const sortedDays = Object.keys(dailyRegistrations).sort((a, b) => parseInt(a) - parseInt(b));

            dailyRegistrationsTableBody.innerHTML = '';
            if (sortedDays.length === 0) {
                dailyRegistrationsTableBody.innerHTML = `<tr><td colspan="2" class="text-center py-4 text-muted">No hay registros para este mes.</td></tr>`;
                return;
            }

            sortedDays.forEach(day => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-center">${day}</td>
                    <td class="text-center">${dailyRegistrations[day]} usuario(s)</td>
                `;
                dailyRegistrationsTableBody.appendChild(row);
            });
        }

        /**
         * Carga la información del usuario actual y la muestra en la UI.
         */
        async function loadUserInfo() {
            try {
                const user = await window.api.getUserData();
                if (user && user.correo) {
                    userEmailElem.textContent = user.usuario;
                } else {
                    userEmailElem.textContent = 'Desconocido';
                }
            } catch (error) {
                console.error('Error al cargar la información del usuario:', error);
                userEmailElem.textContent = 'Error';
            }
        }

        // Función para manejar el cierre de sesión
        logoutButton.onclick = async () => {
            // Invoca el IPC para limpiar el token en el proceso principal
            await window.api.logoutUser();
            // Redirige a la página de login
            window.api.loadMainWindow('login.html');
        };


        // --- Event Listeners para la Navegación ---
        navButtons.dashboard.onclick = () => showSection('dashboard');
        navButtons.users.onclick = () => showSection('users');
        navButtons.matches.onclick = () => showSection('matches');
        navButtons.teams.onclick = () => showSection('teams');
        navButtons.ligas.onclick = () => showSection('ligas');
        navButtons.seasons.onclick = () => showSection('seasons');
        navButtons.estados.onclick = () => showSection('estados');
        navButtons.roles.onclick = () => showSection('roles');

        // Carga la sección de partidos por defecto al iniciar
        document.addEventListener('DOMContentLoaded', () => {
            loadUserInfo();
            showSection('dashboard');
        });
    </script>
</body>
</html>